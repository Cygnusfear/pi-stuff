---
id: p-31b8
status: in_progress
deps: []
links: []
created: 2026-02-14T09:30:43Z
type: task
priority: 2
assignee: strip-oauth
tags: [team]
---
# Strip OAuth/keyring/ClaudeCli dead code from totalrecall-rs at /Users/alexander/Projects/totalrecall-rs

Goal: Remove all OAuth, keyring, keychain, codesign, and ClaudeCliProvider code. OpenRouter is the only LLM path now.

Specific changes:

1. **Delete `src/synthesis/auth.rs`** — the entire AuthMethod enum and keyring resolution. Replace with a simple helper that just checks env vars.

2. **Delete `src/llm/cli.rs`** — the entire ClaudeCliProvider that spawns `claude` subprocess. Not needed.

3. **Update `src/llm/mod.rs`** — remove `pub mod cli` and `pub use cli::ClaudeCliProvider`

4. **Update `src/synthesis/mod.rs`** — remove `pub use auth::AuthMethod`, remove `pub mod auth`, remove the deprecated ClaudeClient re-export

5. **Update `src/synthesis/provider.rs`** — 
   - Remove `ClaudeCliProvider` import
   - Remove `AuthMethod` import and usage
   - Remove `from_auth()` method entirely
   - Simplify `from_environment()`: try OpenRouter first (check `config.use_openrouter` + key), fall back to `AnthropicProvider` (just needs `ANTHROPIC_API_KEY` env var, no keychain). Remove all OAuth code paths.
   - Remove the `ClaudeAdapter` legacy struct at the bottom
   - Update tests

6. **Update `src/synthesis/dreaming.rs`** — in `build_stage1_provider()` (~line 530), remove `ClaudeCliProvider` import and fallback. It should try OpenRouter first, then AnthropicProvider.

7. **Update `src/synthesis/client.rs`** — remove any AuthMethod usage. If the whole file is just a legacy Claude client, consider removing it or simplifying.

8. **Update `src/synthesis/queue.rs`** — remove AuthMethod usage if present

9. **Update `src/cli/commands/eval.rs`** — remove ClaudeCliProvider usage, use OpenRouterProvider or AnthropicProvider instead

10. **Update `src/lib.rs`** — remove any re-exports of removed items

11. **Check Cargo.toml** — remove `keyring` crate dependency if present

Verification: `DATABASE_URL="postgresql://totalrecall:totalrecall_dev@localhost:5432/totalrecall" cargo build --release` must succeed. Run `cargo test` too.

Commit message: `refactor: strip OAuth/keyring/ClaudeCli dead code - OpenRouter only`

Strip OAuth/keyring/ClaudeCli dead code from totalrecall-rs at /Users/alexander/Projects/totalrecall-rs

Goal: Remove all OAuth, keyring, keychain, codesign, and ClaudeCliProvider code. OpenRouter is the only LLM path now.

Specific changes:

1. **Delete `src/synthesis/auth.rs`** — the entire AuthMethod enum and keyring resolution. Replace with a simple helper that just checks env vars.

2. **Delete `src/llm/cli.rs`** — the entire ClaudeCliProvider that spawns `claude` subprocess. Not needed.

3. **Update `src/llm/mod.rs`** — remove `pub mod cli` and `pub use cli::ClaudeCliProvider`

4. **Update `src/synthesis/mod.rs`** — remove `pub use auth::AuthMethod`, remove `pub mod auth`, remove the deprecated ClaudeClient re-export

5. **Update `src/synthesis/provider.rs`** — 
   - Remove `ClaudeCliProvider` import
   - Remove `AuthMethod` import and usage
   - Remove `from_auth()` method entirely
   - Simplify `from_environment()`: try OpenRouter first (check `config.use_openrouter` + key), fall back to `AnthropicProvider` (just needs `ANTHROPIC_API_KEY` env var, no keychain). Remove all OAuth code paths.
   - Remove the `ClaudeAdapter` legacy struct at the bottom
   - Update tests

6. **Update `src/synthesis/dreaming.rs`** — in `build_stage1_provider()` (~line 530), remove `ClaudeCliProvider` import and fallback. It should try OpenRouter first, then AnthropicProvider.

7. **Update `src/synthesis/client.rs`** — remove any AuthMethod usage. If the whole file is just a legacy Claude client, consider removing it or simplifying.

8. **Update `src/synthesis/queue.rs`** — remove AuthMethod usage if present

9. **Update `src/cli/commands/eval.rs`** — remove ClaudeCliProvider usage, use OpenRouterProvider or AnthropicProvider instead

10. **Update `src/lib.rs`** — remove any re-exports of removed items

11. **Check Cargo.toml** — remove `keyring` crate dependency if present

Verification: `DATABASE_URL="postgresql://totalrecall:totalrecall_dev@localhost:5432/totalrecall" cargo build --release` must succeed. Run `cargo test` too.

Commit message: `refactor: strip OAuth/keyring/ClaudeCli dead code - OpenRouter only`

